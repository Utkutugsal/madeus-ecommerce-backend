<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madeus Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .card-shadow-lg {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .hover-scale {
            transition: all 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .sidebar-gradient {
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .table-row {
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background-color: #f8fafc;
            transform: scale(1.01);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px 0 rgba(16, 185, 129, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(16, 185, 129, 0.5);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.4);
        }
        
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.5);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .pulse-success {
            animation: pulseSuccess 2s infinite;
        }
        
        @keyframes pulseSuccess {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" x-data="adminApp()" x-init="init()">
    <!-- Loading Screen -->
    <div x-show="loading" class="fixed inset-0 z-50 flex items-center justify-center gradient-bg">
        <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h3 class="text-xl font-semibold mb-2">Madeus Admin Panel</h3>
            <p class="text-blue-100">Yükleniyor...</p>
        </div>
    </div>

    <!-- Login Page -->
    <div x-show="!isLoggedIn && !loading" class="min-h-screen flex items-center justify-center gradient-bg">
        <div class="max-w-md w-full mx-4">
            <div class="glass-effect rounded-2xl p-8 card-shadow-lg">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-crown text-2xl text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Madeus Admin</h2>
                    <p class="text-blue-100">Yönetim Paneli</p>
                </div>
                
                <form @submit.prevent="login" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-blue-100 mb-2">Kullanıcı Adı</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input x-model="loginForm.username" type="text" required
                                   class="w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
                                   placeholder="Kullanıcı adınızı girin">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-blue-100 mb-2">Şifre</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input x-model="loginForm.password" type="password" required
                                   class="w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
                                   placeholder="Şifrenizi girin">
                        </div>
                    </div>
                    
                    <button type="submit" :disabled="loginLoading" 
                            class="w-full bg-white text-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-all duration-300 disabled:opacity-50">
                        <span x-show="!loginLoading">Giriş Yap</span>
                        <span x-show="loginLoading" class="flex items-center justify-center">
                            <div class="loading-spinner mr-2" style="width: 1rem; height: 1rem; border-width: 2px;"></div>
                            Giriş Yapılıyor...
                        </span>
                    </button>
                    
                    <div x-show="loginError" class="bg-red-500/20 border border-red-500/50 rounded-lg p-3 text-red-100 text-sm text-center" x-text="loginError"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div x-show="isLoggedIn && !loading" class="min-h-screen bg-gray-50">
        <!-- Sidebar -->
        <div class="fixed inset-y-0 left-0 z-40 w-64 sidebar-gradient transform transition-transform duration-300 ease-in-out slide-in"
             :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'">
            
            <!-- Logo -->
            <div class="flex items-center justify-center h-16 bg-black/20">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                        <i class="fas fa-crown text-blue-600"></i>
                    </div>
                    <span class="text-xl font-bold text-white">Madeus</span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="mt-8 px-4">
                <div class="space-y-2">
                    <a @click="currentView = 'dashboard'" 
                       :class="currentView === 'dashboard' ? 'bg-white/20 text-white' : 'text-blue-100 hover:bg-white/10'"
                       class="flex items-center px-4 py-3 rounded-lg cursor-pointer transition-all duration-200 group">
                        <i class="fas fa-chart-line mr-3 text-lg"></i>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    
                    <a @click="currentView = 'orders'" 
                       :class="currentView === 'orders' ? 'bg-white/20 text-white' : 'text-blue-100 hover:bg-white/10'"
                       class="flex items-center px-4 py-3 rounded-lg cursor-pointer transition-all duration-200 group">
                        <i class="fas fa-shopping-cart mr-3 text-lg"></i>
                        <span class="font-medium">Siparişler</span>
                        <span x-show="stats.pending_orders > 0" 
                              class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full pulse-success"
                              x-text="stats.pending_orders"></span>
                    </a>
                    
                    <a @click="logout" 
                       class="flex items-center px-4 py-3 rounded-lg cursor-pointer text-blue-100 hover:bg-red-500/20 hover:text-red-200 transition-all duration-200 group">
                        <i class="fas fa-sign-out-alt mr-3 text-lg"></i>
                        <span class="font-medium">Çıkış Yap</span>
                    </a>
                </div>
            </nav>
            
            <!-- User Info -->
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-black/20">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div>
                        <p class="text-white font-medium">Admin</p>
                        <p class="text-blue-200 text-sm">Yönetici</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="lg:ml-64 transition-all duration-300">
            <!-- Top Bar -->
            <div class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button @click="sidebarOpen = !sidebarOpen" class="lg:hidden text-gray-600 hover:text-gray-900">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 class="text-2xl font-bold text-gray-900" x-text="currentView === 'dashboard' ? 'Dashboard' : 'Siparişler'"></h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-clock mr-1"></i>
                            Son Güncelleme: <span x-text="lastUpdate"></span>
                        </div>
                        <button @click="refreshData" 
                                class="p-2 text-gray-500 hover:text-blue-600 transition-colors duration-200">
                            <i class="fas fa-sync-alt" :class="refreshing ? 'animate-spin' : ''"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div x-show="currentView === 'dashboard'" class="p-6 fade-in">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 card-shadow hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Toplam Sipariş</p>
                                <p class="text-3xl font-bold text-gray-900" x-text="stats.total_orders || 0"></p>
                                <p class="text-xs text-green-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    +12% bu ay
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Bekleyen</p>
                                <p class="text-3xl font-bold text-yellow-600" x-text="stats.pending_orders || 0"></p>
                                <p class="text-xs text-yellow-600 mt-1">
                                    <i class="fas fa-clock mr-1"></i>
                                    İşlem bekliyor
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-hourglass-half text-yellow-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Teslim Edilen</p>
                                <p class="text-3xl font-bold text-green-600" x-text="stats.delivered_orders || 0"></p>
                                <p class="text-xs text-green-600 mt-1">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Tamamlandı
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 card-shadow hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 mb-1">Toplam Gelir</p>
                                <p class="text-3xl font-bold text-emerald-600" x-text="formatPrice(stats.total_revenue || 0)"></p>
                                <p class="text-xs text-emerald-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    +8% bu ay
                                </p>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-lira-sign text-emerald-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="bg-white rounded-xl card-shadow overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Son Siparişler</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sipariş</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Müşteri</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tutar</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="order in recentOrders" :key="order.id">
                                    <tr class="table-row">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                    <i class="fas fa-receipt text-blue-600 text-sm"></i>
                                                </div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900" x-text="'#' + order.order_number"></div>
                                                    <div class="text-sm text-gray-500" x-text="order.item_count + ' ürün'"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm font-medium text-gray-900" x-text="order.user_name"></div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm font-bold text-gray-900" x-text="formatPrice(order.total_amount)"></div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="status-badge" :class="getStatusColor(order.status)" x-text="getStatusText(order.status)"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-500" x-text="formatDate(order.created_at)"></div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Content -->
            <div x-show="currentView === 'orders'" class="p-6 fade-in">
                <!-- Filters -->
                <div class="bg-white rounded-xl p-6 card-shadow mb-6">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <select x-model="orderFilter" @change="loadOrders" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="all">Tüm Siparişler</option>
                                <option value="pending">Bekleyen</option>
                                <option value="confirmed">Onaylanan</option>
                                <option value="shipped">Kargoda</option>
                                <option value="delivered">Teslim Edilen</option>
                                <option value="cancelled">İptal Edilen</option>
                            </select>
                            
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input x-model="searchTerm" @input="debounceSearch" type="text" 
                                       placeholder="Sipariş ara..." 
                                       class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="text-sm text-gray-500">
                            Toplam <span class="font-semibold" x-text="totalOrders"></span> sipariş
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="bg-white rounded-xl card-shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sipariş</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Müşteri</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tutar</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kargo</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="order in orders" :key="order.id">
                                    <tr class="table-row">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                    <i class="fas fa-receipt text-blue-600"></i>
                                                </div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900" x-text="'#' + order.order_number"></div>
                                                    <div class="text-xs text-gray-500" x-text="formatDate(order.created_at)"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                                    <i class="fas fa-user text-gray-600 text-sm"></i>
                                                </div>
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900" x-text="order.user_name"></div>
                                                    <div class="text-xs text-gray-500" x-text="order.user_email"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm font-bold text-gray-900" x-text="formatPrice(order.total_amount)"></div>
                                            <div class="text-xs text-gray-500" x-text="order.item_count + ' ürün'"></div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="status-badge" :class="getStatusColor(order.status)" x-text="getStatusText(order.status)"></span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-900" x-text="order.cargo_company || 'Belirtilmemiş'"></div>
                                            <div class="text-xs text-gray-500" x-text="order.cargo_tracking_number || 'Takip No Yok'"></div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <button @click="openOrderModal(order)" class="btn-secondary">
                                                <i class="fas fa-edit mr-2"></i>
                                                Düzenle
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Update Modal -->
    <div x-show="showOrderModal" class="fixed inset-0 z-50 modal-backdrop" x-transition>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all" 
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100">
                
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-900">Sipariş Güncelle</h3>
                    <p class="text-sm text-gray-500 mt-1">Sipariş durumunu ve kargo bilgilerini güncelleyin</p>
                </div>
                
                <div class="p-6 space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-truck mr-2"></i>
                            Sipariş Durumu
                        </label>
                        <select x-model="editingOrder.status" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="pending">🕐 Beklemede</option>
                            <option value="confirmed">✅ Onaylandı</option>
                            <option value="shipped">🚚 Kargoya Verildi</option>
                            <option value="delivered">📦 Teslim Edildi</option>
                            <option value="cancelled">❌ İptal Edildi</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-building mr-2"></i>
                            Kargo Firması
                        </label>
                        <input x-model="editingOrder.cargo_company" type="text" 
                               placeholder="Örn: Aras Kargo, Yurtiçi Kargo"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-barcode mr-2"></i>
                            Kargo Takip Numarası
                        </label>
                        <input x-model="editingOrder.cargo_tracking_number" type="text" 
                               placeholder="Örn: 123456789"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
                
                <div class="p-6 bg-gray-50 rounded-b-2xl flex justify-end space-x-3">
                    <button @click="showOrderModal = false" 
                            class="px-6 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                        İptal
                    </button>
                    <button @click="updateOrder" :disabled="updating" class="btn-primary">
                        <span x-show="!updating" class="flex items-center">
                            <i class="fas fa-save mr-2"></i>
                            Güncelle
                        </span>
                        <span x-show="updating" class="flex items-center">
                            <div class="loading-spinner mr-2" style="width: 1rem; height: 1rem; border-width: 2px;"></div>
                            Güncelleniyor...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div x-show="toast.show" 
         class="fixed top-4 right-4 z-50 max-w-sm w-full"
         x-transition:enter="transform ease-out duration-300 transition"
         x-transition:enter-start="translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2"
         x-transition:enter-end="translate-y-0 opacity-100 sm:translate-x-0">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i :class="toast.type === 'success' ? 'fas fa-check-circle text-green-500' : 'fas fa-exclamation-circle text-red-500'" class="text-xl"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900" x-text="toast.message"></p>
                    </div>
                </div>
            </div>
            <div class="h-1 bg-gray-200">
                <div :class="toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'" 
                     class="h-full transition-all duration-3000 ease-linear" 
                     style="width: 100%; animation: shrink 3s linear;"></div>
            </div>
        </div>
    </div>

    <style>
        @keyframes shrink {
            from { width: 100%; }
            to { width: 0%; }
        }
    </style>

    <script>
        function adminApp() {
            return {
                // Auth state
                isLoggedIn: false,
                loading: true,
                loginLoading: false,
                loginError: '',
                loginForm: { username: '', password: '' },
                token: localStorage.getItem('adminToken') || '',
                
                // UI state
                sidebarOpen: false,
                currentView: 'dashboard',
                lastUpdate: '',
                refreshing: false,
                
                // Data
                stats: {},
                recentOrders: [],
                orders: [],
                
                // Pagination
                currentPage: 1,
                ordersPerPage: 20,
                totalOrders: 0,
                totalPages: 0,
                
                // Filters
                orderFilter: 'all',
                searchTerm: '',
                searchTimeout: null,
                
                // Modal
                showOrderModal: false,
                editingOrder: {},
                updating: false,
                
                // Toast
                toast: { show: false, message: '', type: 'success' },
                
                async init() {
                    console.log('Admin app initializing...');
                    
                    if (this.token) {
                        console.log('Token found, attempting auto-login...');
                        this.isLoggedIn = true;
                        await this.loadDashboard();
                    } else {
                        console.log('No token found, showing login form');
                    }
                    
                    this.loading = false;
                    this.updateTime();
                    setInterval(() => this.updateTime(), 60000);
                    
                    // Auto refresh every 30 seconds
                    setInterval(() => {
                        if (this.isLoggedIn) {
                            this.refreshData();
                        }
                    }, 30000);
                },
                
                async login() {
                    console.log('Attempting login...');
                    this.loginLoading = true;
                    this.loginError = '';
                    
                    try {
                        const response = await fetch('/api/admin/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        console.log('Login response status:', response.status);
                        const data = await response.json();
                        console.log('Login response data:', data);
                        
                        if (data.success) {
                            this.token = data.token;
                            localStorage.setItem('adminToken', this.token);
                            this.isLoggedIn = true;
                            await this.loadDashboard();
                            console.log('Login successful');
                        } else {
                            this.loginError = data.message || 'Giriş başarısız';
                            console.error('Login failed:', data.message);
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        this.loginError = 'Giriş yapılırken hata oluştu';
                    }
                    
                    this.loginLoading = false;
                },
                
                logout() {
                    this.token = '';
                    localStorage.removeItem('adminToken');
                    this.isLoggedIn = false;
                    this.currentView = 'dashboard';
                    console.log('Logged out');
                },
                
                async loadDashboard() {
                    console.log('Loading dashboard...');
                    try {
                        const response = await fetch('/api/admin/dashboard/stats', {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        console.log('Dashboard response status:', response.status);
                        
                        if (response.status === 401) {
                            this.logout();
                            return;
                        }
                        
                        const data = await response.json();
                        console.log('Dashboard data:', data);
                        
                        if (data.success) {
                            this.stats = data.data.stats || {};
                            this.recentOrders = data.data.recentOrders || [];
                            console.log('Dashboard loaded successfully');
                        } else {
                            console.error('Dashboard load failed:', data.message);
                        }
                    } catch (error) {
                        console.error('Dashboard load error:', error);
                    }
                },
                
                async loadOrders() {
                    console.log('Loading orders...');
                    try {
                        const params = new URLSearchParams({
                            page: this.currentPage,
                            limit: this.ordersPerPage,
                            status: this.orderFilter
                        });
                        
                        if (this.searchTerm) {
                            params.append('search', this.searchTerm);
                        }
                        
                        const response = await fetch(`/api/admin/orders?${params}`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        console.log('Orders response status:', response.status);
                        
                        if (response.status === 401) {
                            this.logout();
                            return;
                        }
                        
                        const data = await response.json();
                        console.log('Orders data:', data);
                        
                        if (data.success) {
                            this.orders = data.data.orders || [];
                            this.totalOrders = data.data.pagination?.total || 0;
                            this.totalPages = data.data.pagination?.pages || 0;
                            console.log('Orders loaded successfully');
                        } else {
                            console.error('Orders load failed:', data.message);
                        }
                    } catch (error) {
                        console.error('Orders load error:', error);
                    }
                },
                
                async refreshData() {
                    this.refreshing = true;
                    
                    try {
                        if (this.currentView === 'dashboard') {
                            await this.loadDashboard();
                        } else if (this.currentView === 'orders') {
                            await this.loadOrders();
                        }
                    } catch (error) {
                        console.error('Refresh error:', error);
                    }
                    
                    this.refreshing = false;
                },
                
                openOrderModal(order) {
                    console.log('Opening order modal for:', order);
                    this.editingOrder = { ...order };
                    this.showOrderModal = true;
                },
                
                async updateOrder() {
                    console.log('Updating order:', this.editingOrder);
                    this.updating = true;
                    
                    try {
                        const response = await fetch(`/api/admin/orders/${this.editingOrder.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                status: this.editingOrder.status,
                                cargo_company: this.editingOrder.cargo_company,
                                cargo_tracking_number: this.editingOrder.cargo_tracking_number
                            })
                        });
                        
                        console.log('Update response status:', response.status);
                        const data = await response.json();
                        console.log('Update response data:', data);
                        
                        if (data.success) {
                            this.showToast('✅ Sipariş başarıyla güncellendi!', 'success');
                            this.showOrderModal = false;
                            await this.loadOrders();
                            await this.loadDashboard(); // Refresh stats
                        } else {
                            this.showToast('❌ ' + (data.message || 'Güncelleme başarısız'), 'error');
                        }
                    } catch (error) {
                        console.error('Update error:', error);
                        this.showToast('❌ Güncelleme sırasında hata oluştu', 'error');
                    }
                    
                    this.updating = false;
                },
                
                debounceSearch() {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        this.currentPage = 1;
                        this.loadOrders();
                    }, 500);
                },
                
                // Watch for view changes
                $watch: {
                    currentView: {
                        handler(newView) {
                            console.log('View changed to:', newView);
                            if (newView === 'orders') {
                                this.loadOrders();
                            }
                        },
                        immediate: false
                    }
                },
                
                // Utility methods
                updateTime() {
                    this.lastUpdate = new Date().toLocaleTimeString('tr-TR');
                },
                
                showToast(message, type = 'success') {
                    this.toast = { show: true, message, type };
                    setTimeout(() => {
                        this.toast.show = false;
                    }, 3000);
                },
                
                formatPrice(price) {
                    return new Intl.NumberFormat('tr-TR', {
                        style: 'currency',
                        currency: 'TRY'
                    }).format(price || 0);
                },
                
                formatDate(date) {
                    return new Date(date).toLocaleDateString('tr-TR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                
                getStatusColor(status) {
                    switch (status) {
                        case 'pending': return 'bg-yellow-100 text-yellow-800 border-yellow-200';
                        case 'confirmed': return 'bg-blue-100 text-blue-800 border-blue-200';
                        case 'shipped': return 'bg-purple-100 text-purple-800 border-purple-200';
                        case 'delivered': return 'bg-green-100 text-green-800 border-green-200';
                        case 'cancelled': return 'bg-red-100 text-red-800 border-red-200';
                        default: return 'bg-gray-100 text-gray-800 border-gray-200';
                    }
                },
                
                getStatusText(status) {
                    switch (status) {
                        case 'pending': return 'Beklemede';
                        case 'confirmed': return 'Onaylandı';
                        case 'shipped': return 'Kargoya Verildi';
                        case 'delivered': return 'Teslim Edildi';
                        case 'cancelled': return 'İptal Edildi';
                        default: return 'Bilinmeyen';
                    }
                }
            }
        }
    </script>
</body>
</html> 